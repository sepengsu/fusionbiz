<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì „ì²˜ë¦¬ê¸° ì„¤ì •</title>
  <link rel="stylesheet" href="/frontend/preprocessor/style.css">
</head>
<body>
  <div class="container">
    <h1>ğŸ“„ í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬ê¸°</h1>

    <section class="section">
      <div>
        <label for="fileInput">í…ìŠ¤íŠ¸ ë˜ëŠ” PDF íŒŒì¼ ì—…ë¡œë“œ</label>
        <input type="file" id="fileInput" accept=".txt,.pdf">

        <label for="splitMethod">í…ìŠ¤íŠ¸ ë¶„í•  ë°©ë²•</label>
        <select id="splitMethod">
          <option>RecursiveCharacterTextSplitter</option>
          <option>CharacterTextSplitter</option>
          <option>MarkdownHeaderTextSplitter</option>
        </select>

        <label for="chunkSize">Chunk Size</label>
        <input type="range" id="chunkSize" min="100" max="2000" value="200">
        <span id="chunkSizeValue">200</span>

        <label for="chunkOverlap">Chunk Overlap</label>
        <input type="range" id="chunkOverlap" min="0" max="500" value="0">
        <span id="chunkOverlapValue">0</span>
      </div>

      <div>
        <label for="vectorType">ë²¡í„° ì €ì¥ì†Œ ìœ í˜•</label>
        <select id="vectorType">
          <option>Chroma</option>
          <option>FAISS</option>
        </select>

        <label for="searchType">ê²€ìƒ‰ ìœ í˜•</label>
        <select id="searchType">
          <option>similarity</option>
          <option>mmr</option>
        </select>

        <label for="topK">ê²€ìƒ‰ ê²°ê³¼ ìˆ˜(k)</label>
        <input type="range" id="topK" min="1" max="10" value="3">
        <span id="topKValue">3</span>

        <label for="embeddingModel">ì„ë² ë”© ëª¨ë¸</label>
        <select id="embeddingModel">
          <option>text-embedding-3-small</option>
          <option>sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2</option>
        </select>
      </div>
    </section>

    <div class="button-container">
      <button onclick="processData()" id="processBtn">ğŸš€ ë°ì´í„° ì²˜ë¦¬</button>
    </div>

    <hr>

    <h3>ğŸ“˜ SQL ê°€ì´ë“œ ë¬¸ì„œ ì—…ë¡œë“œ</h3>
    <div>
      <input type="file" id="sqlFileInput" accept=".txt">
      <button onclick="uploadSQLGuide()">ğŸ§  SQL ë¬¸ì„œ ì²˜ë¦¬</button>
    </div>

    <div id="loading" class="loading">âš™ï¸ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</div>
    <div id="statusArea" class="status-success"></div>

    <div id="previewArea" class="section preview-section" style="display: none;">
      <h3>ğŸ“„ ëœë¤ ì²­í¬ ë¬¸ì„œ ë¯¸ë¦¬ë³´ê¸°</h3>
      <p><strong>ğŸ“ ì¶œì²˜:</strong> <span id="sourceFile"></span></p>
      <div id="sampleContent" class="preview-content"></div>
    </div>
  </div>

  <script>
    document.getElementById("chunkSize").oninput = function() {
      document.getElementById("chunkSizeValue").innerText = this.value;
    };
    document.getElementById("chunkOverlap").oninput = function() {
      document.getElementById("chunkOverlapValue").innerText = this.value;
    };
    document.getElementById("topK").oninput = function() {
      document.getElementById("topKValue").innerText = this.value;
    };

    function processData() {
      const file = document.getElementById("fileInput").files[0];
      if (!file) return alert("íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.");

      const formData = new FormData();
      formData.append("file", file);
      formData.append("chunk_size", document.getElementById("chunkSize").value);
      formData.append("chunk_overlap", document.getElementById("chunkOverlap").value);
      formData.append("embedding_model", document.getElementById("embeddingModel").value);
      formData.append("vector_type", document.getElementById("vectorType").value);

      document.getElementById("loading").style.display = "block";
      document.getElementById("statusArea").innerText = "";
      document.getElementById("previewArea").style.display = "none";

      fetch("/upload_log", {
        method: "POST",
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("loading").style.display = "none";
        document.getElementById("statusArea").innerText = `âœ… ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ!`;
        document.getElementById("sourceFile").innerText = data.filename;
        document.getElementById("sampleContent").innerText = data.sample || "ë¯¸ë¦¬ë³´ê¸° ì—†ìŒ";
        document.getElementById("previewArea").style.display = "block";
      })
      .catch(err => {
        document.getElementById("loading").style.display = "none";
        document.getElementById("statusArea").innerText = `âŒ ì²˜ë¦¬ ì‹¤íŒ¨: ${err}`;
      });
    }

    function uploadSQLGuide() {
      const file = document.getElementById("sqlFileInput").files[0];
      if (!file) return alert("SQL ê°€ì´ë“œ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.");

      const formData = new FormData();
      formData.append("sqlfile", file);
      formData.append("embedding_model", document.getElementById("embeddingModel").value);

      document.getElementById("loading").style.display = "block";
      document.getElementById("statusArea").innerText = "";
      document.getElementById("previewArea").style.display = "none";

      fetch("/upload_sql_guide", {
        method: "POST",
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("loading").style.display = "none";
        document.getElementById("statusArea").innerText = `âœ… SQL ê°€ì´ë“œ ì²˜ë¦¬ ì™„ë£Œ: ${file.name}`;
      })
      .catch(err => {
        document.getElementById("loading").style.display = "none";
        document.getElementById("statusArea").innerText = `âŒ ì²˜ë¦¬ ì‹¤íŒ¨: ${err}`;
      });
    }
  </script>
</body>
</html>
